# node-coverage-badges

[![Open in Visual Studio Code](https://img.shields.io/static/v1?logo=visualstudiocode&label=&message=Open%20in%20Visual%20Studio%20Code&labelColor=2c2c32&color=007acc&logoColor=007acc)](https://github.dev/jpb06/node-coverage-badges)
![Github workflow](https://img.shields.io/github/actions/workflow/status/jpb06/node-coverage-badges/tests-scan.yml?branch=master&logo=github-actions&label=last%20workflow)
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=jpb06_node-coverage-badges)
[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=sqale_rating)](https://sonarcloud.io/dashboard?id=jpb06_node-coverage-badges)
[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=security_rating)](https://sonarcloud.io/dashboard?id=jpb06_node-coverage-badges)
[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=reliability_rating)](https://sonarcloud.io/dashboard?id=jpb06_node-coverage-badges)
[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=coverage)](https://sonarcloud.io/dashboard?id=jpb06_node-coverage-badges)
![Coverage](./badges/coverage-total.svg)
[![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=ncloc)](https://sonarcloud.io/summary/new_code?id=jpb06_node-coverage-badges)
[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=sqale_index)](https://sonarcloud.io/summary/new_code?id=jpb06_node-coverage-badges)
[![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=code_smells)](https://sonarcloud.io/dashboard?id=jpb06_node-coverage-badges)
[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=bugs)](https://sonarcloud.io/summary/new_code?id=jpb06_node-coverage-badges)
[![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=vulnerabilities)](https://sonarcloud.io/summary/new_code?id=jpb06_node-coverage-badges)
[![Duplicated Lines (%)](https://sonarcloud.io/api/project_badges/measure?project=jpb06_node-coverage-badges&metric=duplicated_lines_density)](https://sonarcloud.io/dashboard?id=jpb06_node-coverage-badges)
![npm bundle size](https://img.shields.io/bundlephobia/min/node-coverage-badges)
![Last commit](https://img.shields.io/github/last-commit/jpb06/node-coverage-badges?logo=git)

Generating coverage badges from jest coverage report.

<!-- readme-package-icons start -->

<p align="left"><a href="https://docs.github.com/en/actions" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/GithubActions-Dark.svg" /></a>&nbsp;<a href="https://www.typescriptlang.org/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/TypeScript.svg" /></a>&nbsp;<a href="https://nodejs.org/en/docs/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/NodeJS-Dark.svg" /></a>&nbsp;<a href="https://pnpm.io/motivation" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Pnpm-Dark.svg" /></a>&nbsp;<a href="https://axios-http.com/fr/docs/intro" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Axios-Dark.svg" /></a>&nbsp;<a href="https://eslint.org/docs/latest/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Eslint-Dark.svg" /></a>&nbsp;<a href="https://prettier.io/docs/en/index.html" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Prettier-Dark.svg" /></a>&nbsp;<a href="https://vitest.dev/guide/" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Vitest-Dark.svg" /></a>&nbsp;<a href="https://www.effect.website/docs/quickstart" target="_blank"><img height="50" src="https://raw.githubusercontent.com/jpb06/jpb06/master/icons/Effect-Dark.svg" /></a></p>

<!-- readme-package-icons end -->

## âš¡ Badges for everyone

This package uses [shields.io](https://shields.io/) to created coverage badges from a coverage json summary file generated by your favorite test runner.

| Badge                                                   | Description                                    |
| ------------------------------------------------------- | ---------------------------------------------- |
| ![Branches](./badges/coverage-branches.svg)             | Percentage of DD-paths followed during tests   |
| ![Functions](./badges/coverage-functions.svg)           | Percentage of functions executed within tests  |
| ![Lines](./badges/coverage-lines.svg)                   | Percentage of lines covered by tests           |
| ![Statements](./badges/coverage-statements.svg)         | Percentage of statements executed within tests |
| ![Jest coverage](./badges/coverage-total.svg)           | Average of the above coverage percentages      |

## âš¡ Github action

If you want to integrate this to your CI/CD, you have a [github action available for this](https://github.com/marketplace/actions/coverage-badges-generation-action).

## âš¡ Requirements

You need a test runner to generate the report summary file. For example [vitest](https://vitest.dev/guide/) or [jest](https://jestjs.io/docs/getting-started).

## âš¡ Setup

### ðŸ”¶ Install

```shell
npm i -D node-coverage-badges
# or
yarn add -D node-coverage-badges
# or
pnpm i -D node-coverage-badges
```

### ðŸ”¶ Test runner configuration

You will need to add json-summary to coverage reporters in your test runner config.

#### ðŸ§¿ vitest

`vite config`

```typescript
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    coverage: {
      reporter: ['json-summary'],
      // ...
    },
  },
});
```

#### ðŸ§¿ jest

`jest config`

```javascript
module.exports = {
   coverageReporters: ["json-summary"];
   // ...
};
```

## âš¡ Usage

You have two ways to generate coverage badges: cli and node. Both will create a folder where .svg files will be written.

### ðŸ”¶ Cli

You can add a script to your package.json like so:

```json
  "scripts": {
    "badges": "generateBadges"
  },
```

The `generateBadges` function accepts three optional arguments to specify:

- a custom path for the input json summary file.
- a custom path for the output path.
- a [simple icon](https://simpleicons.org/) slug to specify a custom badge icon.

```shell
# will generate badges from './coverage/coverage-summary.json' in './badges' (default)
yarn generateBadges

# will generate badges from './myModule/coverage-summary.json' in './cool' folder.
yarn generateBadges -c ./myModule/coverage-summary.json -o ./cool

# will generate badges from './myModule/coverage-summary.json' in './cool' folder using the vitest icon.
yarn generateBadges -c ./myModule/coverage-summary.json -o ./cool -l vitest
```

### ðŸ”¶ Node

Another way is to directly use the package:

```typescript
import { generateBadges } from 'node-coverage-badges';

(async () => {
  // will generate badges from './coverage/coverage-summary.json' in './badges' (default)
  await generateBadges();
})();
```

The function optionally accepts two arguments to specify a custom path for the json summary file and the output path:

```typescript
import { generateBadges } from 'node-coverage-badges';

(async () => {
  // will generate badges from './myModule/coverage-summary.json' in './cool' using the jest icon.
  await generateBadges('./myModule/coverage-summary.json', './cool', 'jest');
})();
```

### ðŸ”¶ Effect

You can also directly import the effect, if you use [Effect](https://effect.website/docs/introduction):

```typescript
import { generateBadgesEffect } from 'node-coverage-badges';

const task = Effect.gen(function* () {
  //...

  const result = yield* generateBadgesEffect();
})
```

The function signature is the following:

```typescript
const generateBadgesEffect: (
  coverageSummaryPath?: string, 
  outputPath?: string, 
  logo?: string
) => Effect.Effect<boolean, FsError | AxiosError, never>
```

## âš¡ Thanks

Big thanks to [Shield](https://github.com/badges/shields) for this awesome tool!
